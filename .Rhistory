desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
# Convert date columns for SQLite
#dh_trend_backup <- dh_trend # take this out
dh_trend$desk_id_start_date <- format(dh_trend$desk_id_start_date, "%Y-%m-%d")
dh_trend$desk_id_end_date <- format(dh_trend$desk_id_end_date, "%Y-%m-%d")
dh_trend$trend_month <- format(dh_trend$trend_month, "%Y-%m-%d")
# Next we'll add the job title to our data. Each desk_id has a job assigned to it.  That assignment is on the deskjob table
# add Job title
dj <- dbGetQuery(con, "SELECT * FROM DESKJOB")
dh_trend <- dh_trend %>%
left_join(dj)
## Having a hierarchy will make this table more valuable for reporting. Let's add org information.
## The Rollup view lists all the company's desk_ids 4 levels deep along with the level of each desk.
## We will use the lvl04_desk_id to join the company hierarchy data.
## NEED TO EXPLAIN BETTER
# add rollup view
ru <- dbGetQuery(con, "SELECT * FROM ROLLUP")
dh_trend <- dh_trend %>%
left_join(ru, by = c("desk_id" = "lvl04_desk_id"))
## Our last step is to upload the data to a new table as employee_trend
#upload new table employee_trend
dbWriteTable(con, "employee_trend", dh_trend, overwrite = TRUE)
# See results
dbGetQuery(con, "SELECT TREND_MONTH, COUNT(*) FROM EMPLOYEE_TREND WHERE TERMINATION_FLAG = 1 GROUP BY TREND_MONTH")
# Close connection
dbDisconnect(con)
file.remove("my_db.sqlite3")
hrsample::hrsampleCreateSQLite("my_db.sqlite3")
# Connect to database
con <- dbConnect(SQLite(),'my_db.sqlite3')
# Let's also add the employee's name
ei <- dbGetQuery(con, "SELECT * FROM EMPLOYEE_INFO")
# Let's also add the employee's name
ei <- dbGetQuery(con, "SELECT * FROM EMPLOYEEINFO")
# Retrieve deskhistory (point in time table)
dh <- dbGetQuery(con, "SELECT * FROM DESKHISTORY")
## One of the drawbacks of SQLite is that it does not store date formats.  So we will store them as text here.
# Convert SQLite date fields from text to date
dh <- dh %>%
mutate(desk_id_start_date = as.Date(desk_id_start_date),
desk_id_end_date = as.Date(desk_id_end_date))
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
# Sample of one TM
dh %>% filter(employee_num == 21065)
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")
end_date <- as.Date("2018-12-30")
month_list <- seq.Date(start_date, end_date, by = "month")
# Iterate through each deskhistory row to populate each month actives
## Note we had to reassign the termination flag for months that they did not terminate
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date > month_list[i]) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
# Convert date columns for SQLite
#dh_trend_backup <- dh_trend # take this out
dh_trend$desk_id_start_date <- format(dh_trend$desk_id_start_date, "%Y-%m-%d")
dh_trend$desk_id_end_date <- format(dh_trend$desk_id_end_date, "%Y-%m-%d")
dh_trend$trend_month <- format(dh_trend$trend_month, "%Y-%m-%d")
# Next we'll add the job title to our data. Each desk_id has a job assigned to it.  That assignment is on the deskjob table
# add Job title
dj <- dbGetQuery(con, "SELECT * FROM DESKJOB")
dh_trend <- dh_trend %>%
left_join(dj)
## Having a hierarchy will make this table more valuable for reporting. Let's add org information.
## The Rollup view lists all the company's desk_ids 4 levels deep along with the level of each desk.
## We will use the lvl04_desk_id to join the company hierarchy data.
## NEED TO EXPLAIN BETTER
# add rollup view
ru <- dbGetQuery(con, "SELECT * FROM ROLLUP")
dh_trend <- dh_trend %>%
left_join(ru, by = c("desk_id" = "lvl04_desk_id"))
dh_trend <- dh_trend %>%
left_join(ei %>% select(employee_num,
last_name,
first_name))
## We are going to remove the CEO columns since they are not adding value
ru <- ru %>%
select(-lvl00_desk_id, - lvl00_org)
file.remove("my_db.sqlite3")
# Close connection
dbDisconnect(con)
file.remove("my_db.sqlite3")
# Let's reorder some of the rows.
dh_trendx <- dh_trend %>%
select(trend_month,
employee_num,
last_name,
first_name,
job_name,
depth,
everything())
dh_trendx %>% filter(lvl03_org != lvl04_org)
file.remove("my_db.sqlite3")
setwd("C:\\Users\\Anyone\\Desktop\\Toss")
library(tidyverse)
library(RSQLite)
library(lubridate)
#library(DBI) test without this
# Load hrsample -----------------------------------------------------------
#devtools::install_github("harryahlas/hrsample")
hrsample::hrsampleCreateSQLite("my_db.sqlite3")
# Connect to database
con <- dbConnect(SQLite(),'my_db.sqlite3')
# Retrieve deskhistory (point in time table)
dh <- dbGetQuery(con, "SELECT * FROM DESKHISTORY")
## One of the drawbacks of SQLite is that it does not store date formats.  So we will store them as text here.
# Convert SQLite date fields from text to date
dh <- dh %>%
mutate(desk_id_start_date = as.Date(desk_id_start_date),
desk_id_end_date = as.Date(desk_id_end_date)) %>%
select(-promotion_flag)
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
# Sample of one TM
dh %>% filter(employee_num == 21065)
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")
end_date <- as.Date("2018-12-30")
month_list <- seq.Date(start_date, end_date, by = "month")
# Iterate through each deskhistory row to populate each month actives
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date > month_list[i]) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
# Convert date columns for SQLite
#dh_trend_backup <- dh_trend # take this out
dh_trend$desk_id_start_date <- format(dh_trend$desk_id_start_date, "%Y-%m-%d")
dh_trend$desk_id_end_date <- format(dh_trend$desk_id_end_date, "%Y-%m-%d")
dh_trend$trend_month <- format(dh_trend$trend_month, "%Y-%m-%d")
# Next we'll add the job title to our data. Each desk_id has a job assigned to it.  That assignment is on the deskjob table
# add Job title
dj <- dbGetQuery(con, "SELECT * FROM DESKJOB")
dh_trend <- dh_trend %>%
left_join(dj)
## Having a hierarchy will make this table more valuable for reporting. Let's add org information.
## The Rollup view lists all the company's desk_ids 4 levels deep along with the level of each desk.
## We will use the lvl04_desk_id to join the company hierarchy data.
## NEED TO EXPLAIN BETTER
## We are going to remove the CEO columns since they are not adding value
# add rollup view
ru <- dbGetQuery(con, "SELECT * FROM ROLLUP")
## We are going to remove the CEO columns since they are not adding value
ru <- ru %>%
select(-lvl00_desk_id, - lvl00_org)
dh_trend <- dh_trend %>%
left_join(ru, by = c("desk_id" = "lvl04_desk_id"))
# Let's also add the employee's name
ei <- dbGetQuery(con, "SELECT * FROM EMPLOYEEINFO")
dh_trend <- dh_trend %>%
left_join(ei %>% select(employee_num,
last_name,
first_name))
# Let's reorder some of the rows.
dh_trend <- dh_trend %>%
select(trend_month,
employee_num,
last_name,
first_name,
job_name,
depth,
everything())
## Our last step is to upload the data to a new table as employee_trend
#upload new table employee_trend
dbWriteTable(con, "employee_trend", dh_trend, overwrite = TRUE)
# See results
et_sample <- dbGetQuery(con, "SELECT * FROM EMPLOYEE_TREND ORDER BY RAND() LIMIT 5")
# See results
et_sample <- dbGetQuery(con, "SELECT * FROM EMPLOYEE_TREND ORDER BY RANDOM() LIMIT 5")
et_sample
glimpse(et_sample)
dbGetQuery(con, "SELECT TREND_MONTH, COUNT(*) FROM EMPLOYEE_TREND WHERE TERMINATION_FLAG = 1 GROUP BY TREND_MONTH")
# Close connection
dbDisconnect(con)
dh %>% sample_n(3)
dh %>% filter(employee_num == sample_n(employee_num,1))
sample_employee_num <- sample_n(deskhistory_table$employee_num, 1)
sample_employee_num <- sample_n(deskhistory_table, 1) %>% select(employee_num)
sample(dh$employee_num,1)
dh %>% filter(employee_num == sample_employee_num)
sample(dh$employee_num,1)
sample(dh$employee_num,1)
sample_employee_num <- sample(dh$employee_num,1)
dh %>% filter(employee_num == sample_employee_num)
month_list[i]
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
deskhistory_table %>% filter(employee_num==14405)
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T) %>% count(n)
dh %>% count(employee_num, desk_id_start_date, sort = T)
file.remove("my_db.sqlite3")
library(tidyverse)
library(RSQLite)
library(lubridate)
# Load hrsample -----------------------------------------------------------
#devtools::install_github("harryahlas/hrsample")
hrsample::hrsampleCreateSQLite("my_db.sqlite3")
# Connect to database
con <- dbConnect(SQLite(),'my_db.sqlite3')
#The first table we will need is the deskhistory table.  We will import it into an object called <code>dh</code>.
# Retrieve deskhistory (point in time table)
dh <- dbGetQuery(con, "SELECT * FROM DESKHISTORY")
sample_employee_num <- sample(dh$employee_num,1)
dh %>% filter(employee_num == sample_employee_num)
# Our goal is to get this point in time data in to a monthly snapshot, which can be very useful for reporting and analysis.
# The monthly table will have one row for each month the employee is in a desk_id.
## One of the drawbacks of SQLite is that it does not store date formats.  So the first transform will be to convert the date fields from text into dates.
# Convert SQLite date fields from text to date
dh <- dh %>%
mutate(desk_id_start_date = as.Date(desk_id_start_date),
desk_id_end_date = as.Date(desk_id_end_date)) %>%
select(-promotion_flag)
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
#We need to create a list of all months that will be included in our calendar table data t
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")
end_date <- as.Date("2018-12-30")
month_list <- seq.Date(start_date, end_date, by = "month")
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
deskhistory_table %>% filter(employee_num == 383)
deskhistory_table %>% filter(employee_num == 38346)
dh_trend %>% filter(employee_num == 38346)
deskhistory_table %>% filter(employee_num == 38346)
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
start_date <- as.Date("1999-01-01")
end_date <- as.Date("2018-12-30")
month_list <- seq.Date(start_date, end_date, by = "month")
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
deskhistory_table %>% filter(employee_num == 38346)
month_list
i <- 7
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_active %>% filter(employee_num == 38346)
ceiling_date(month_list[i])
month_list[i]
typeof(month_list[i])
as.Date(month_list[i])
ceiling_date(as.Date(month_list[i])
)
#We need to create a list of all months that will be included in our calendar table data t
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01", tz = "UTC")
#We need to create a list of all months that will be included in our calendar table data t
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01", tz = "UTC")
end_date <- as.Date("2018-12-30", tz = "UTC")
month_list <- seq.Date(start_date, end_date, by = "month")
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(as.Date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
# A more detailed look at the code is below. Feel free to SKIP AHEAD (link).
# <sub header>Inside the for loop
# The first piece of the for loop specifies how many loops to run.  This is the number of months in our list of months (<code>month_list</code>)
# for (i in 1:length(month_list)) {
# Then we'll create a temporary data frame <code>dh_trend_active</code> that captures active employees for the month in the current iteration.
# The code looks at the <code>desk_id_start_date</code> and <code>desk_id_end_date</code> columns to determine if an employee was active during that month.
I THINK desk_id_end_date > month_list[i]) NEEDS TO BE CEILING DATE
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
#We need to create a list of all months that will be included in our calendar table data. <em>Lubridate</em> works best with the UTC time zone.
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01", tz = "UTC")
end_date <- as.Date("2018-12-31", tz = "UTC")
month_list <- seq.Date(start_date, end_date, by = "month")
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month"),
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
i <- 7
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]),
desk_id_end_date >= ceiling_date(month_list[i])) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i])) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_active %>% filter(employee_num==38346)
aaa <- dh_trend_active %>% filter(employee_num==38346)
aaa$desk_id_end_date[1]
ceiling_date(month_list[i])
ceiling_date(month_list[i], "month")
#We need to create a list of all months that will be included in our calendar table data. <em>Lubridate</em> works best with the UTC time zone.
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")#, tz = "UTC")
end_date <- as.Date("2018-12-31")#, tz = "UTC")
month_list <- seq.Date(start_date, end_date, by = "month")
ceiling_date(month_list[i], "month")
month_list[i]
ceiling_date(month_list[i]-1, "month")
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
#We need to create a list of all months that will be included in our calendar table data. <em>Lubridate</em> works best with the UTC time zone.
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")#, tz = "UTC")
end_date <- as.Date("2018-12-31")#, tz = "UTC")
month_list <- seq.Date(start_date, end_date, by = "month")
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i]) - 1,
desk_id_end_date >= ceiling_date(month_list[i]) - 1) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i]) - 1) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month") - 1,
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
i <- 7
print(month_list[i])
ceiling_date(month_list[i]) - 1
ceiling_date(month_list[i])
ceiling_date(month_list[i], "month")
ceiling_date(month_list[i], "month") - 1
# Next, let's create a placeholder data frame for our monthly calendar data
# Create empty deskhistory_trend table (monthly calendar table)
dh_trend <- tibble()
#We need to create a list of all months that will be included in our calendar table data. <em>Lubridate</em> works best with the UTC time zone.
# Get list of all months, by end of month
start_date <- as.Date("1999-01-01")#, tz = "UTC")
end_date <- as.Date("2018-12-31")#, tz = "UTC")
month_list <- seq.Date(start_date, end_date, by = "month")
# Here is the code.  We'll review it in more detail below.
## Note we had to reassign the termination flag for months that they did not terminate
## Also, we'll remove the promotion rows
# Find employees that were active for entire month or termed during that month
# Example For 2010-01-31: if their end date is > 2010-01-01 and start date <= 2010-01-31 and not termed then keep
for (i in 1:length(month_list)) {
print(month_list[i])
dh_trend_active <- dh %>%
filter(desk_id_start_date <= ceiling_date(month_list[i], "month") - 1,
desk_id_end_date >= ceiling_date(month_list[i], "month") - 1) %>%
filter(termination_flag == 0 | desk_id_end_date != ceiling_date(month_list[i], "month") - 1) %>%
mutate(trend_month = month_list[i],
termination_flag = 0)
dh_trend_term <- dh %>%
filter(termination_flag == 1,
desk_id_end_date <= ceiling_date(month_list[i], "month") - 1,
desk_id_end_date >= month_list[i]
) %>%
mutate(trend_month = month_list[i])
dh_trend <- bind_rows(dh_trend, dh_trend_active, dh_trend_term)
}
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T)
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T) %>% filter(n=2)
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T) %>% filter(n==2)
#CHECK, SHOULD BE NONE >1
dh_trend %>% count(trend_month, employee_num, name = "empmonth", sort = T) %>% filter(n==2) %>% select(employee_num) %>% distinct()
ceiling_date(as.Date("2019/01/05"))
ceiling_date(as.Date("2019/01/05"), "month")
ceiling_date(as.Date("2019/01/05"), "day")
View(dh_trend_term)
month_list[i]
ceiling_date(month_list[i], "month") - 1
ceiling_date(month_list[i], "month")
