geom_col(fill = default_color, width = .6) +
labs(title = "Current Headcount by Line of Business") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1)
)
employee_distribution
ggsave(employee_distribution, filename =  "images/employee_distribution.png", device = "png")
merit_increases <- salaryhistory_table %>%
mutate(`Salary Increase Year` = lubridate::year(salary_effective_date)) %>%
filter(salary_increase > 0#,
##`Salary Increase Year` >= 2010,
#`Salary Increase Year` <= 2018
) %>%
ggplot(aes(x = salary_increase)) +
geom_histogram(bins = 15, fill = default_color) +
scale_x_continuous(labels = percent) +
facet_wrap(~`Salary Increase Year`) +
labs(x = "% Increase",
y = "Count of Merit Increases",
title = "Merit Increases by Year") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
merit_increases
ggsave(merit_increases, filename =  "images/merit_increases.png", device = "png")
#salary_distribution <-
salary_distribution <- deskhistory_table %>%
filter(desk_id_end_date == as.Date("2999-01-01")) %>%
left_join(salaryhistory_table) %>%
group_by(employee_num, desk_id) %>%
summarise(current_salary = max(salary)) %>% arrange(desc(employee_num)) %>%
left_join(deskjob_table) %>%
ungroup() %>%
group_by(job_name) %>%
summarize(avg_salary = mean(current_salary, na.rm = TRUE),
job_count = n()) %>%
filter(!grepl(pattern = "Leader|CEO", x = job_name )) %>%
ggplot(aes(x = fct_reorder(job_name, -avg_salary), y = avg_salary)) +
geom_col(fill = default_color, width = .8) +
scale_y_continuous(labels = scales::dollar) +
labs(title = "Average Salary by Common Jobs") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1)
)
salary_distribution
ggsave(salary_distribution, filename =  "images/salary_distribution.png", device = "png")
job_distribution <- deskhistory_table %>%
filter(desk_id_end_date == as.Date("2999-01-01")) %>%
right_join(deskjob_table) %>%
count(job_name) %>%
arrange(n) %>%
ggplot(aes(x = fct_reorder(job_name, n), y = n)) +
geom_col(fill = default_color, width = .8) +
labs(title = "Current Job Distribution") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.title.y=element_blank(),
axis.title.x=element_blank(),
axis.text.x = element_text(angle = 45, hjust = 1)
)+
coord_flip()
job_distribution
ggsave(job_distribution, filename =  "images/job_distribution.png", device = "png")
# Promotions --------------------------------------------------------------
#count of promotions by year
deskhistory_table %>%
filter(desk_id_start_date <= as.Date("2019-01-01")) %>% # needed for this run only, probably ok to delete later
left_join(hierarchy_spread_all) %>%
mutate(year = year(desk_id_start_date)) %>%
count(year, lvl01_org, promotion_flag) %>%
filter(promotion_flag == 1) %>%
ggplot(aes(x = year, y = n)) +
geom_col(fill = default_color) +
facet_wrap(~lvl01_org) +
labs(y = "Count of Promotions",
title = "Promotions by Business Line") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x      = element_blank())
deskhistory_table %>%
filter(desk_id_start_date <= as.Date("2019-01-01")) %>% # needed for this run only, probably ok to delete later
left_join(hierarchy_spread_all) %>%
mutate(year = year(desk_id_start_date)) %>%
count(year, lvl01_org, promotion_flag) %>%
filter(year != 1999) %>%
ggplot(aes(x = year, y = n, fill = promotion_flag)) +
geom_col(position = "dodge") +
facet_wrap(~lvl01_org) +
labs(y = "Count of Promotions",
title = "Promotions by Business Line") +
theme_minimal() +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text.x      = element_blank())
?hrsample
?hrsample::hrsampleCreatePostgreSQL
devtools::install_github("harryahlas/hrsample")
library(hrsample)
library(tidyverse)
library(scales)
library(openxlsx)
report_name <- "PA73405 - Attrition by Job 2009"
as_of_date <- Sys.Date()
knitr::kable(deskjob_table[sample(nrow(deskjob_table),5),])
knitr::kable(deskhistory_table[sample(nrow(deskhistory_table),5),])
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
spread(termination_flag, n, fill = 0)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup()
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate"))
# Summary data frame
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
cto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount))
library(scales)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = scales::percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count( job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
# 8. Termination rate is low
deskhistory_table %>%
filter(desk_id_start_date <= as.Date("2006-01-01"),
desk_id_end_date >= as.Date("2005-01-01")) %>%
mutate(termination = if_else(termination_flag == 1 & (year(desk_id_end_date) == 2005 ), "term2017", "notterm2017")) %>%
count(termination) %>%
spread(key = termination, value = n) %>%
mutate(pct = term2017 / (term2017 + notterm2017))
deskhistory_table %>%
left_join(deskjob_table)
deskhistory_table
deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01"))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup()
hcto_summary %>% count(termination_flag)
# 8. Termination rate is low
deskhistory_table %>%
filter(desk_id_start_date <= as.Date("2010-01-01"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
mutate(termination = if_else(termination_flag == 1 & (year(desk_id_end_date) == 2005 ), "term2017", "notterm2017")) %>%
count(termination) %>%
spread(key = termination, value = n) %>%
mutate(pct = term2017 / (term2017 + notterm2017))
# 8. Termination rate is low
deskhistory_table %>%
filter(desk_id_start_date <= as.Date("2010-01-01"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
mutate(termination = if_else(termination_flag == 1 & (lubridate::year(desk_id_end_date) == 2005 ), "term2017", "notterm2017")) %>%
count(termination) %>%
spread(key = termination, value = n) %>%
mutate(pct = term2017 / (term2017 + notterm2017))
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2010-01-01"),
desk_id_end_date <= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate"))
View(hcto_summary)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
View(hcto_summary)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1 & year(desk_id_end_date) == 2009, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
library(lubridate)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1 & year(desk_id_end_date) == 2009, "Terminated", "DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
sum(hcto_summary$Headcount)
deskhistory_table %>% filter(desk_id == 1)
employeeinfo_table %>% filter(employee_num == 16684)
disclaimer_info <- data.frame(Information =
c("Source: hrsample",
paste("Data as of", as_of_date, "."),
"Data includes all employees rolling up to CEO Danica Hammel who were active at any point from Jan 1, 2009 through December 31, 2009.",
"If the employee had multiple jobs during 2009, only the most recent job is counted.",
"Data is confidential and should be shared on a need to know basis only.",
"Do not distribute externally."))
wb <- createWorkbook()
addWorksheet(wb, report_name)
addWorksheet(wb, "Data Disclaimer")
writeDataTable(wb, 1, hcto_summary)
writeDataTable(wb, 2, disclaimer_info)
addStyle(wb, 2, style = createStyle(wrapText = TRUE), rows = 1:7, cols = 1)
setColWidths(wb, 2, 1, widths = 50)
saveWorkbook(wb, paste0(report_name, as_of_date, ".xlsx"), TRUE)
library(hrsample)
library(tidyverse)
library(scales)
library(lubridate)
library(openxlsx)
# Tracking information
report_name <- "PA73405 - Attrition by Job 2009"
as_of_date <- Sys.Date()
knitr::kable(deskhistory_table[sample(nrow(deskhistory_table),5),])
knitr::kable(deskjob_table[sample(nrow(deskjob_table),5),])
knitr::kable(deskhistory_table[sample(nrow(deskhistory_table),5),])
# Summary data frame
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1 & year(desk_id_end_date) == 2009,
"Terminated",
"DidNotTerminate")) %>%
count(job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
hcto_summary <- deskhistory_table %>%
left_join(deskjob_table) %>%
filter(desk_id_start_date <= as.Date("2009-12-31"),
desk_id_end_date >= as.Date("2009-01-01")) %>%
arrange(desc(desk_id_end_date)) %>%
group_by(employee_num) %>%
filter(row_number() == 1) %>%
ungroup() %>%
mutate(year = "2009",
termination_flag = if_else(termination_flag == 1 & year(desk_id_end_date) == 2009,
"Terminated",
"DidNotTerminate")) %>%
count(year, job_name, termination_flag) %>%
spread(termination_flag, n, fill = 0) %>%
mutate(Headcount =  Terminated + DidNotTerminate,
TerminationRate = percent(Terminated / Headcount)) %>%
arrange(desc(Terminated / Headcount))
knitr::kable(hcto_summary)
disclaimer_info <- data.frame(Information =
c("Source: hrsample",
paste("Data as of", as_of_date, "."),
"Data includes all employees rolling up to CEO Danica Hammel who were active at any point from Jan 1, 2009 through December 31, 2009.",
"If the employee had multiple jobs during 2009, only the most recent job is counted.",
"Data is confidential and should be shared on a need to know basis only.",
"Do not distribute externally."))
# Export to Excel
wb <- createWorkbook()
addWorksheet(wb, report_name)
addWorksheet(wb, "Data Disclaimer")
writeDataTable(wb, 1, hcto_summary)
writeDataTable(wb, 2, disclaimer_info)
addStyle(wb, 2, style = createStyle(wrapText = TRUE), rows = 1:7, cols = 1)
setColWidths(wb, 2, 1, widths = 50)
saveWorkbook(wb, paste0(report_name, as_of_date, ".xlsx"), TRUE)
deskjob_table %>% sample_n(5)
deskhistory_table %>% sample_n(5) %>% glimpse()
kable(deskjob_table[sample(nrow(deskjob_table),5),])
library(RCurl)
setwd("C:\\Development\\github\\blog")
blog_files_all <- list.files(getwd(),
#pattern=(".html"),
full.names=F,
recursive = TRUE)
# do not change this file or image files
blog_files <- blog_files_all[blog_files_all != "scripts/updateURLs.R"]
blog_files <- blog_files[grepl(blog_files,pattern = "/images/") != TRUE]
blog_files <- blog_files[grepl(blog_files,pattern = "jpg|png|gif") != TRUE]
pw = "3mypj5xh"
for (blog_file in blog_files_all) {
print(blog_file)
ftpUpload(blog_file,
paste0("sftp://edemise:",pw,"@boron.he.net/home/edemise/public_html/harry.ahlas.com/",
blog_file),
.opts = list(ftp.create.missing.dirs=TRUE)
)
}
